<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>عرش الفراغ</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial,sans-serif}
body{background:#0a0a0a;color:#eee;height:100vh;overflow:hidden;background:radial-gradient(circle at top, #1a1a2e, #0f0f1f)}
.stars{position:fixed;inset:0;background:transparent url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='2' height='2'><circle cx='1' cy='1' r='0.8' fill='%234499ff'/></svg>") repeat;opacity:0.4;animation:s 10s infinite}
@keyframes s{0%,100%{opacity:0.3}50%{opacity:0.7}}
.container{max-width:520px;margin:0 auto;padding:15px;height:100vh;display:flex;flex-direction:column}
.card{background:rgba(30,30,50,0.85);border:1px solid #0066ff;border-radius:16px;padding:25px;margin:10px 0;box-shadow:0 8px 32px #0008;backdrop-filter:blur(12px)}
h1,h2{color:#00d4ff;text-align:center;margin:15px 0;text-shadow:0 0 15px #00d4ff40}
input,button,select{width:100%;padding:14px;margin:10px 0;border:none;border-radius:12px;font-size:1.1rem}
input,select{background:#222;color:#fff}
button{background:linear-gradient(45deg,#00d4ff,#0099ff);color:white;cursor:pointer;box-shadow:0 4px 15px #00d4ff40;transition:.3s}
button:hover{transform:translateY(-3px);box-shadow:0 8px 25px #00d4ff70}
.btn-small{background:#333;color:#00d4ff;padding:10px 20px;width:auto;display:inline-block;margin:8px;border-radius:10px}
#game{display:none}
.progress{height:12px;background:#222;border-radius:6px;overflow:hidden;margin:10px 0}
.progress-bar{height:100%;background:linear-gradient(90deg,#00ff88,#00d4ff);width:0%;transition:width 0.8s}
.alliance-tag{color:#ff0;font-weight:bold}
</style>
</head>
<body>

<div class="stars"></div>

<!-- صفحة تسجيل الدخول -->
<div class="container" id="auth">
  <div class="card">
    <h1>عرش الفراغ</h1>
    <input type="text" id="username" placeholder="اسم الإمبراطور">
    <input type="password" id="password" placeholder="كلمة المرور">
    <button onclick="login()">دخول</button>
    <button onclick="register()" style="background:#333">إنشاء حساب جديد</button>
  </div>
</div>

<!-- اللعبة الرئيسية -->
<div class="container" id="game">
  <div class="card">
    <h2>مرحباً <span id="playerName"></span> 
      <span id="allianceTag" class="alliance-tag"></span>
    </h2>
    <div style="text-align:center">
      <span style="background:#0066ff;padding:5px 15px;border-radius:20px">المستوى <span id="level">1</span></span>
      <div class="progress"><div class="progress-bar" id="xpBar"></div></div>
      <small>خبرة: <span id="xp">0</span>/100</small>
    </div>

    <div style="margin:20px 0;text-align:center">
      <button class="btn-small" onclick="show('empire')">إمبراطوريتي</button>
      <button class="btn-small" onclick="show('battle')">المعارك</button>
      <button class="btn-small" onclick="show('mine')">التعدين</button>
      <button class="btn-small" onclick="show('alliance')">التحالفات ⚔️</button>
    </div>

    <!-- إمبراطوريتي -->
    <div id="empire" class="section">
      <h3>إمبراطوريتك</h3>
      <p>كواكب: <strong id="planets">0</strong> | أساطيل: <strong id="fleets">0</strong> | طاقة: <strong id="energy">1000</strong></p>
      <button onclick="buildFleet()">بناء أسطول (-300)</button>
      <button onclick="conquerPlanet()">غزو كوكب (+800)</button>
    </div>

    <!-- المعارك والتعدين (كما هي) -->
    <div id="battle" class="section" style="display:none">
      <h3>معركة الأساطيل</h3>
      <p>قوتك: <span id="attackPower">500</span> | العدو: 1200</p>
      <button onclick="startBattle()">هجوم!</button>
      <div id="battleResult"></div>
    </div>

    <div id="mine" class="section" style="display:none">
      <h3>منجم الكريستال</h3>
      <p>كريستال: <strong id="crystals">0</strong></p>
      <button style="font-size:2rem;padding:30px" onclick="mineCrystal()">تعدين!</button>
    </div>

    <!-- نظام التحالفات -->
    <div id="alliance" class="section" style="display:none">
      <h3>التحالفات ⚔️</h3>
      <div id="currentAlliance"></div>
      <hr style="border:1px dashed #444;margin:20px 0">
      <button class="btn-small" onclick="createAlliance()">إنشاء تحالف جديد</button>
      <button class="btn-small" onclick="listAlliances()">عرض كل التحالفات</button>
      <div id="allianceList" style="margin-top:15px"></div>
    </div>

    <button onclick="logout()" style="background:#900;margin-top:30px">خروج</button>
  </div>
</div>

<script>
let player = {name:"", alliance:"", level:1, xp:0, planets:0, fleets:0, energy:1000, crystals:0, attack:500};
let alliances = JSON.parse(localStorage.getItem("alliances") || "{}");

function login(){
  const n = document.getElementById("username").value.trim();
  const p = document.getElementById("password").value;
  if(!n) return alert("أدخل اسمك");
  const key = "player_"+n;
  const data = localStorage.getItem(key);
  if(data && JSON.parse(data).pass !== p) return alert("كلمة مرور خاطئة");
  player = data ? JSON.parse(data) : {name:n, pass:p, alliance:"", level:1, xp:0, planets:0, fleets:0, energy:1000, crystals:0, attack:500};
  startGame();
}
function register(){
  const n = document.getElementById("username").value.trim();
  const p = document.getElementById("password").value;
  if(!n || !p) return alert("املأ البيانات");
  localStorage.setItem("player_"+n, JSON.stringify({name:n, pass:p, alliance:"", level:1, xp:0, planets:0, fleets:0, energy:1000, crystals:0, attack:500}));
  alert("تم إنشاء الحساب! ادخل الآن");
}

function startGame(){
  document.getElementById("auth").style.display="none";
  document.getElementById("game").style.display="flex";
  document.getElementById("playerName").textContent = player.name;
  player.alliance ? document.getElementById("allianceTag").textContent = " ["+player.alliance+"]" : "";
  update();
}

function update(){
  document.getElementById("level").textContent = player.level;
  document.getElementById("xp").textContent = player.xp;
  document.getElementById("xpBar").style.width = (player.xp % 100)+"%";
  document.getElementById("planets").textContent = player.planets;
  document.getElementById("fleets").textContent = player.fleets;
  document.getElementById("energy").textContent = player.energy;
  document.getElementById("crystals").textContent = player.crystals;
  document.getElementById("attackPower").textContent = player.attack;
  localStorage.setItem("player_"+player.name, JSON.stringify(player));
  showCurrentAlliance();
}

function show(s){ document.querySelectorAll(".section").forEach(x=>x.style.display="none"); document.getElementById(s).style.display="block"; if(s==="alliance") listAlliances(); }

function addXP(n){ player.xp += n; while(player.xp >= player.level*100){ player.xp -= player.level*100; player.level++; player.attack += 150; } update(); }

// الألعاب الأساسية
function buildFleet(){ if(player.energy>=300){ player.fleets++; player.energy-=300; addXP(20); update(); }}
function conquerPlanet(){ if(player.fleets>0){ player.planets++; player.energy+=800; player.fleets--; addXP(60); update(); }}
function mineCrystal(){ player.crystals += Math.floor(Math.random()*20)+10; addXP(8); update(); }
function startBattle(){ /* نفس الكود السابق */ }

// نظام التحالفات
function createAlliance(){
  const name = prompt("اسم التحالف:");
  if(!name || alliances[name]) return alert("اسم غير صالح أو موجود");
  alliances[name] = {leader:player.name, members:[player.name], points:0};
  player.alliance = name;
  localStorage.setItem("alliances", JSON.stringify(alliances));
  update();
  alert("تم إنشاء تحالف ["+name+"] بنجاح!");
}
function joinAlliance(name){
  if(alliances[name].members.includes(player.name)) return alert("أنت عضو بالفعل");
  alliances[name].members.push(player.name);
  player.alliance = name;
  localStorage.setItem("alliances", JSON.stringify(alliances));
  update();
  alert("انضممت إلى تحالف ["+name+"]");
}
function showCurrentAlliance(){
  if(player.alliance){
    const a = alliances[player.alliance];
    document.getElementById("currentAlliance").innerHTML = `
      <p>تحالفك: <strong>[${player.alliance}]</strong></p>
      <p>القائد: ${a.leader} | الأعضاء: ${a.members.length}</p>
    `;
  } else {
    document.getElementById("currentAlliance").innerHTML = "<p style='color:#aaa'>غير منضم لأي تحالف</p>";
  }
}
function listAlliances(){
  let html = "<h4 style='color:#00d4ff'>قائمة التحالفات</h4>";
  for(const [name, data] of Object.entries(alliances)){
    html += `<div style="background:#222;padding:10px;margin:8px 0;border-radius:10px">
      <strong>[${name}]</strong> • ${data.members.length} عضو • قائد: ${data.leader}
      <button class="btn-small" onclick="joinAlliance('${name}')" style="float:left">انضمام</button>
    </div>`;
  }
  document.getElementById("allianceList").innerHTML = html || "لا توجد تحالفات بعد";
}

function logout(){
  document.getElementById("game").style.display="none";
  document.getElementById("auth").style.display="flex";
  document.getElementById("username").value = "";
  document.getElementById("password").value = "";
}
</script>
</body>
</html>
