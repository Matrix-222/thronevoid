<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Throne Void</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* تصميم النماذج المضافة */
        .auth-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #2c3e50;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 25px rgba(0, 0, 0, 0.7);
            z-index: 1000;
            width: 300px;
            text-align: center;
        }
        .auth-container input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #4a657c;
            border-radius: 5px;
            background: #1f2a36;
            color: white;
            box-sizing: border-box;
        }
        .auth-container button {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        #loginBtn { background-color: #3498db; color: white; }
        #registerBtn { background-color: #2ecc71; color: white; }
        .hidden { display: none !important; }

        /* تغيير تنسيق الأزرار في الهيدر */
        #nav-auth a {
            cursor: pointer;
        }
    </style>
</head>
<body>
    <canvas id="stars"></canvas>
    <header>
        <h1 id="site-title">Throne Void</h1>
        <nav id="nav-auth">
            <a id="nav-login" data-key="login">Login</a>
            <a id="nav-register" data-key="register">Register</a>
            <a href="dashboard.html" id="nav-dashboard" data-key="dashboard" class="hidden">Dashboard</a>
            <a id="nav-logout" data-key="logout" class="hidden">Logout</a>
        </nav>
        <div id="user-info" class="hidden">
            مرحباً، <span id="user-email-display"></span>!
        </div>
        <div>
            <button id="themeToggle">Toggle Theme</button>
            <button id="langToggle">العربية</button>
        </div>
    </header>

    <div id="authForms" class="hidden">
        
        <div id="loginForm" class="auth-container hidden">
            <h2>تسجيل الدخول</h2>
            <input type="email" id="loginEmail" placeholder="البريد الإلكتروني">
            <input type="password" id="loginPassword" placeholder="كلمة المرور">
            <button id="loginBtn">دخول</button>
            <button class="secondary" onclick="showForm('register')">إنشاء حساب جديد</button>
            <a href="#" style="color: #bdc3c7; display: block; margin-top: 15px;" onclick="hideForms()">إغلاق</a>
        </div>

        <div id="registerForm" class="auth-container hidden">
            <h2>إنشاء حساب</h2>
            <input type="email" id="regEmail" placeholder="البريد الإلكتروني">
            <input type="password" id="regPassword" placeholder="كلمة المرور (6 أحرف أو أكثر)">
            <button id="registerBtn">تسجيل</button>
            <button class="secondary" onclick="showForm('login')">لدي حساب بالفعل</button>
            <a href="#" style="color: #bdc3c7; display: block; margin-top: 15px;" onclick="hideForms()">إغلاق</a>
        </div>
    </div>

    <div class="hero">
        <h2 id="hero-title">Welcome to Throne Void</h2>
        <p id="hero-text">Explore the galaxy, build your fleet, dominate alliances, and survive the cosmic challenges in a vast universe full of opportunities.</p>
        <div class="buttons">
            <a id="hero-join-btn" data-key="join">Join Now</a>
            <a href="dashboard.html" id="hero-start-btn" data-key="start">Start Playing</a>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script src="game.js"></script>
    <script src="lang.js"></script>
    
    <script type="module">
        // 1. استيراد دوال Firebase الضرورية
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } 
        from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // 2. إعدادات Firebase (تم دمج كود مشروعك الفعلي)
        const firebaseConfig = {
            apiKey: "AIzaSyB-bfHRJW3E8KW3-o-PkNW6xi5ytrTKMJE", 
            authDomain: "thronevoid.firebaseapp.com",
            projectId: "thronevoid",
            storageBucket: "thronevoid.firebasestorage.app",
            messagingSenderId: "958587822012",
            appId: "1:958587822012:web:312cf3d9e7c87e1c6415b9",
            measurementId: "G-N34T3VRGX0"
        };
        // ------------------------------------------

        // تهيئة Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // --- دوال التحكم في الواجهة (إظهار وإخفاء) ---

        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const authFormsContainer = document.getElementById('authForms');

        window.showForm = (type) => {
            authFormsContainer.classList.remove('hidden');
            if (type === 'login') {
                loginForm.classList.remove('hidden');
                registerForm.classList.add('hidden');
            } else if (type === 'register') {
                registerForm.classList.remove('hidden');
                loginForm.classList.add('hidden');
            }
        };

        window.hideForms = () => {
            authFormsContainer.classList.add('hidden');
            loginForm.classList.add('hidden');
            registerForm.classList.add('hidden');
        };

        // --- ربط أزرار التنقل ---
        document.getElementById('nav-login').addEventListener('click', () => showForm('login'));
        document.getElementById('nav-register').addEventListener('click', () => showForm('register'));
        document.getElementById('hero-join-btn').addEventListener('click', (e) => {
            e.preventDefault(); 
            showForm('register');
        });
        document.getElementById('nav-logout').addEventListener('click', () => {
            signOut(auth).then(() => {
                alert("تم تسجيل الخروج بنجاح.");
            }).catch((error) => {
                alert("خطأ في تسجيل الخروج: " + error.message);
            });
        });

        // --- دالة إنشاء حساب جديد (مع انتقال لـ Dashboard) ---
        document.getElementById('registerBtn').addEventListener('click', () => {
            const email = document.getElementById('regEmail').value;
            const pass = document.getElementById('regPassword').value;

            createUserWithEmailAndPassword(auth, email, pass)
                .then((userCredential) => {
                    // الانتقال إلى لوحة التحكم
                    window.location.href = "dashboard.html";
                })
                .catch((error) => {
                    alert("خطأ في التسجيل: " + error.message);
                });
        });

        // --- دالة تسجيل الدخول (مع انتقال لـ Dashboard) ---
        document.getElementById('loginBtn').addEventListener('click', () => {
            const email = document.getElementById('loginEmail').value;
            const pass = document.getElementById('loginPassword').value;

            signInWithEmailAndPassword(auth, email, pass)
                .then((userCredential) => {
                    // الانتقال إلى لوحة التحكم
                    window.location.href = "dashboard.html";
                })
                .catch((error) => {
                    alert("خطأ في تسجيل الدخول: " + error.message);
                });
        });

        // --- مراقب حالة المستخدم (الأهم) ---
        onAuthStateChanged(auth, (user) => {
            const loginLink = document.getElementById('nav-login');
            const registerLink = document.getElementById('nav-register');
            const dashboardLink = document.getElementById('nav-dashboard');
            const logoutLink = document.getElementById('nav-logout');
            const userInfoDiv = document.getElementById('user-info');
            const userEmailDisplay = document.getElementById('user-email-display');

            if (user) {
                // المستخدم مسجل دخوله
                loginLink.classList.add('hidden');
                registerLink.classList.add('hidden');
                dashboardLink.classList.remove('hidden');
                logoutLink.classList.remove('hidden');
                userInfoDiv.classList.remove('hidden');
                userEmailDisplay.innerText = user.email;
            } else {
                // المستخدم غير مسجل
                loginLink.classList.remove('hidden');
                registerLink.classList.remove('hidden');
                dashboardLink.classList.add('hidden');
                logoutLink.classList.add('hidden');
                userInfoDiv.classList.add('hidden');
                hideForms();
            }
        });

        // Theme toggle 
        const toggle = document.getElementById('themeToggle');
        toggle.addEventListener('click', () => { document.body.classList.toggle('light'); });
        
    </script>
</body>
</html>
