<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="ADMIN_PANEL">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø´Ø±Ù - Throne Void</title>
    <link rel="stylesheet" href="style.css"> 
    <style>
        .admin-container {
            max-width: 1100px;
            margin: 40px auto;
            background-color: #1a1a2e; /* Ø®Ù„ÙÙŠØ© Ø£Ø¹Ù…Ù‚ Ù„Ù„Ù…Ø´Ø±Ù */
            border: 2px solid var(--accent-red);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 0 30px rgba(227, 27, 35, 0.4); /* Ø¸Ù„ Ø£Ø­Ù…Ø± */
            color: #ddd;
        }
        .admin-container h2 {
            color: var(--accent-yellow);
            text-align: center;
            margin-bottom: 25px;
            text-transform: uppercase;
        }
        #userList {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: #242440;
        }
        #userList th, #userList td {
            padding: 12px;
            text-align: right;
            border-bottom: 1px solid #3c3c66;
            font-size: 0.9em;
        }
        #userList th {
            background-color: var(--accent-red);
            color: white;
            text-transform: uppercase;
        }
        .user-row:hover {
            background-color: #2c2c50;
        }
        .action-button {
            padding: 6px 10px;
            margin: 2px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
            font-size: 0.85em;
        }
        .ban-btn { background-color: #e74c3c; color: white; }
        .ban-btn:hover { background-color: #c0392b; }
        .mute-btn { background-color: #f1c40f; color: #333; }
        .mute-btn:hover { background-color: #d8af00; }
        .unban-btn { background-color: #2ecc71; color: white; }
        .unban-btn:hover { background-color: #27ae60; }
        .status-badge {
            padding: 4px 8px;
            border-radius: 3px;
            font-weight: bold;
        }
        .status-active { background-color: #2ecc71; }
        .status-banned { background-color: #e74c3c; }
        .status-muted { background-color: #f1c40f; color: #333; }
        .status-admin { background-color: var(--accent-yellow); color: #1a1a2e; }
        
        /* Ø±Ø³Ø§Ù„Ø© Ø±ÙØ¶ Ø§Ù„ÙˆØµÙˆÙ„ */
        #accessDenied {
            text-align: center;
            color: var(--accent-red);
            font-size: 1.5em;
            margin-top: 50px;
        }
    </style>
</head>
<body>
    <header>
        <h1>THRONES OF THE VOID - ADMIN</h1>
        <div>
            <button onclick="window.location='dashboard.html'" style="background-color: #2ecc71;" data-i18n="DASHBOARD">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
            <button id="logoutBtn" style="background-color: var(--accent-red);" data-i18n="LOGOUT">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
        </div>
    </header>

    <main>
        <div class="admin-container" id="adminPanel">
            <h2 data-i18n="MANAGE_USERS">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h2>
            
            <table id="userList">
                <thead>
                    <tr>
                        <th data-i18n="USER_EMAIL">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th>
                        <th data-i18n="AVATAR_URL">ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„</th>
                        <th data-i18n="HIGH_SCORE">Ø£Ø¹Ù„Ù‰ Ù†ØªÙŠØ¬Ø©</th>
                        <th data-i18n="STATUS">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                        <th data-i18n="ACTIONS">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr>
                </thead>
                <tbody id="usersTableBody">
                    </tbody>
            </table>
        </div>
        
        <p id="accessDenied" style="display:none;" data-i18n="ACCESS_DENIED">â›”ï¸ Ù„Ø§ ØªÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø´Ø±Ù.</p>

    </main>

    <script src="i18n.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        // ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ getDocs Ùˆ collection Ù„Ø¬Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        import { getFirestore, collection, getDocs, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // *** Ù…ÙØ§ØªÙŠØ­ Ù…Ø´Ø±ÙˆØ¹Ùƒ Ø§Ù„ÙØ¹Ù„ÙŠ (thronevoid) ***
        const firebaseConfig = {
            apiKey: "AIzaSyB-bfHRJW3E8KW3-o-PkNW6xi5ytrTKMJE", 
            authDomain: "thronevoid.firebaseapp.com",
            projectId: "thronevoid",
            storageBucket: "thronevoid.firebasestorage.app", 
            messagingSenderId: "958587822012",
            appId: "1:958587822012:web:312cf3d9e7c87e1c6415b9",
            measurementId: "G-N34T3VRGX0"
        };
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // ğŸ”¥ğŸ”¥ ÙŠØ¬Ø¨ Ø¹Ù„ÙŠÙƒ ÙˆØ¶Ø¹ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù‡Ù†Ø§ Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø© ğŸ”¥ğŸ”¥
        const ADMIN_EMAIL = "your_email@example.com"; 

        // -------------------------------------------------------------
        //                 Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© (Admin Functions)
        // -------------------------------------------------------------

        // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (ÙƒØªÙ…ØŒ Ø­Ø¸Ø±ØŒ Ø¥Ù„ØºØ§Ø¡)
        async function updateUserStatus(email, statusType, value) {
            const userDocRef = doc(db, "users", email);
            let updateData = {};

            if (statusType === 'banned') {
                updateData = { isBanned: value, isMuted: false }; // Ø§Ù„Ø­Ø¸Ø± ÙŠØ´Ù…Ù„ Ø§Ù„ÙƒØªÙ…
            } else if (statusType === 'muted') {
                updateData = { isMuted: value };
            }

            try {
                await updateDoc(userDocRef, updateData);
                alert(`âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ${email} Ø¨Ù†Ø¬Ø§Ø­!`);
                loadUsers(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
            } catch (error) {
                console.error("Error updating user status:", error);
                alert("âŒ ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©.");
            }
        }

        // Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ù† Firestore
        async function loadUsers() {
            const usersCollectionRef = collection(db, "users");
            const snapshot = await getDocs(usersCollectionRef);
            const usersBody = document.getElementById('usersTableBody');
            usersBody.innerHTML = ''; // Ù…Ø³Ø­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©

            const adminEmail = ADMIN_EMAIL;
            
            snapshot.forEach(doc => {
                const user = doc.data();
                const email = doc.id; // Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù‡Ùˆ ID Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©

                let statusText;
                let statusClass;

                if (email === adminEmail) {
                    statusText = 'ADMIN';
                    statusClass = 'status-admin';
                } else if (user.isBanned) {
                    statusText = 'BANNED';
                    statusClass = 'status-banned';
                } else if (user.isMuted) {
                    statusText = 'MUTED';
                    statusClass = 'status-muted';
                } else {
                    statusText = 'ACTIVE';
                    statusClass = 'status-active';
                }

                const avatarUrl = user.avatarUrl || 'https://via.placeholder.com/40/1e1e1e/ffffff?text=U';
                const score = user.highScore || 0;
                
                // Ø¨Ù†Ø§Ø¡ ØµÙ Ø§Ù„Ø¬Ø¯ÙˆÙ„
                const row = usersBody.insertRow();
                row.className = 'user-row';
                
                // Ø§Ù„Ø®Ù„ÙŠØ© 1: Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
                row.insertCell().textContent = email;
                
                // Ø§Ù„Ø®Ù„ÙŠØ© 2: Ø§Ù„ØµÙˆØ±Ø©
                const avatarCell = row.insertCell();
                avatarCell.innerHTML = `<img src="${avatarUrl}" style="width:40px; height:40px; border-radius:50%; object-fit:cover;">`;
                
                // Ø§Ù„Ø®Ù„ÙŠØ© 3: Ø§Ù„Ù†ØªÙŠØ¬Ø©
                row.insertCell().textContent = score;
                
                // Ø§Ù„Ø®Ù„ÙŠØ© 4: Ø§Ù„Ø­Ø§Ù„Ø©
                row.insertCell().innerHTML = `<span class="status-badge ${statusClass}">${statusText}</span>`;
                
                // Ø§Ù„Ø®Ù„ÙŠØ© 5: Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª
                const actionsCell = row.insertCell();

                if (email !== adminEmail) { // Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø¸Ø± Ø§Ù„Ù…Ø´Ø±Ù
                    // Ø²Ø± Ø§Ù„Ø­Ø¸Ø±/Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¸Ø±
                    if (user.isBanned) {
                        const unbanBtn = document.createElement('button');
                        unbanBtn.className = 'action-button unban-btn';
                        unbanBtn.textContent = 'Unban';
                        unbanBtn.onclick = () => updateUserStatus(email, 'banned', false);
                        actionsCell.appendChild(unbanBtn);
                    } else {
                        const banBtn = document.createElement('button');
                        banBtn.className = 'action-button ban-btn';
                        banBtn.textContent = 'Ban / Kick';
                        banBtn.onclick = () => {
                            if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø¸Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ${email}ØŸ`)) {
                                updateUserStatus(email, 'banned', true);
                            }
                        };
                        actionsCell.appendChild(banBtn);

                        // Ø²Ø± Ø§Ù„ÙƒØªÙ…/Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ÙƒØªÙ… (Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…Ø­Ø¸ÙˆØ±Ø§Ù‹)
                        const muteBtn = document.createElement('button');
                        muteBtn.className = `action-button mute-btn`;
                        muteBtn.textContent = user.isMuted ? 'Unmute' : 'Mute';
                        muteBtn.onclick = () => updateUserStatus(email, 'muted', !user.isMuted);
                        actionsCell.appendChild(muteBtn);
                    }
                }
            });
        }

        // -------------------------------------------------------------
        //                   Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø´Ø±Ù
        // -------------------------------------------------------------

        onAuthStateChanged(auth, (user) => {
            const adminPanel = document.getElementById('adminPanel');
            const accessDenied = document.getElementById('accessDenied');

            if (user && user.email === ADMIN_EMAIL) {
                // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‡Ùˆ Ø§Ù„Ù…Ø´Ø±Ù
                adminPanel.style.display = 'block';
                accessDenied.style.display = 'none';
                loadLanguage(); // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù„ØºØ©
                loadUsers(); // ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
            } else {
                // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„ÙŠØ³ Ø§Ù„Ù…Ø´Ø±Ù Ø£Ùˆ Ù„Ù… ÙŠØ³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                adminPanel.style.display = 'none';
                accessDenied.style.display = 'block';
                loadLanguage(); 
                if (!user) {
                    alert("ÙŠØ¬Ø¨ Ø¹Ù„ÙŠÙƒ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹!");
                    window.location.href = "login.html"; 
                }
            }
        });

        // Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        document.getElementById('logoutBtn').addEventListener('click', () => {
            signOut(auth).then(() => {
                window.location.href = "index.html";
            });
        });

    </script>
</body>
</html>
