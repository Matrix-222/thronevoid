<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="SETTINGS">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª - Throne Void</title>
    <link rel="stylesheet" href="style.css"> 
    <style>
        .settings-container {
            max-width: 800px;
            margin: 40px auto;
            padding: 30px;
            background-color: var(--secondary-dark);
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(243, 156, 18, 0.4);
            color: #ddd;
        }
        .settings-container h2 {
            color: var(--accent-yellow);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #555;
            font-size: 1.5em;
        }
        .settings-section {
            margin-bottom: 30px;
            background-color: #2c2c44;
            padding: 20px;
            border-radius: 8px;
        }
        .settings-section h3 {
            color: #ccc;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        .form-group {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        .form-group label {
            flex: 1;
            text-align: right;
            padding-left: 10px;
            font-weight: bold;
        }
        .form-group input, .form-group select {
            flex: 3;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #555;
            background-color: #333;
            color: #ddd;
        }
        .avatar-options img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            margin: 5px;
            border: 3px solid transparent;
            transition: border-color 0.2s;
        }
        .avatar-options img.selected {
            border-color: var(--accent-yellow);
        }
        .save-btn {
            background-color: #2ecc71;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s;
            margin-top: 10px;
            width: auto;
        }
        .save-btn:hover { background-color: #27ae60; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø®Ø·Ø± */
        .danger-zone {
            border: 2px solid var(--accent-red);
        }
        #deleteAccountBtn {
            background-color: var(--accent-red);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s;
        }
        #deleteAccountBtn:hover { background-color: #c0392b; }
    </style>
</head>
<body>
    <header>
        <h1>THRONES OF THE VOID</h1>
        <div>
            <button onclick="window.location='dashboard.html'" style="background-color: #2ecc71;" data-i18n="DASHBOARD">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
            <button id="logoutBtn" style="background-color: var(--accent-red);" data-i18n="LOGOUT">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
        </div>
    </header>

    <main>
        <div class="settings-container">
            <h2 data-i18n="SETTINGS_PAGE_TITLE">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆØ§Ù„Ù„Ø¹Ø¨Ø©</h2>

            <div class="settings-section">
                <h3 data-i18n="PROFILE_SETTINGS">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</h3>
                
                <div class="form-group">
                    <label data-i18n="USERNAME" for="usernameInput">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</label>
                    <input type="text" id="usernameInput" maxlength="15" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯">
                    <button id="saveUsernameBtn" class="save-btn" data-i18n="SAVE_USERNAME" style="margin-right:10px;">Ø­ÙØ¸ Ø§Ù„Ø§Ø³Ù…</button>
                </div>
                
                <hr style="border-color:#555; margin: 20px 0;">

                <h3 data-i18n="CHANGE_AVATAR">ØªØºÙŠÙŠØ± ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„</h3>
                <div style="text-align: center;">
                    <img id="currentAvatar" src="https://via.placeholder.com/100/1e1e1e/ffffff?text=U" style="width:100px; height:100px; border-radius:50%; object-fit:cover; margin-bottom: 15px;">
                    <p>Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ø£ÙØ§ØªØ§Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ. Ù‚Ù… Ø¨ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙˆØ¯ Ù„Ø¥Ø¶Ø§ÙØ© Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªØºÙŠÙŠØ±.</p>
                </div>

            </div>

            <div class="settings-section">
                <h3 data-i18n="ACCOUNT_SETTINGS">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨</h3>
                <div class="form-group">
                    <label data-i18n="CURRENT_EMAIL">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ:</label>
                    <span id="currentEmailDisplay" style="flex:3; color: var(--accent-yellow);">loading...</span>
                </div>
                </div>

            </div>
    </main>

    <script src="i18n.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // *** Ù…ÙØ§ØªÙŠØ­ Ù…Ø´Ø±ÙˆØ¹Ùƒ Ø§Ù„ÙØ¹Ù„ÙŠ (thronevoid) ***
        const firebaseConfig = {
            apiKey: "AIzaSyB-bfHRJW3E8KW3-o-PkNW6xi5ytrTKMJE", 
            authDomain: "thronevoid.firebaseapp.com",
            projectId: "thronevoid",
            storageBucket: "thronevoid.firebasestorage.app",
            messagingSenderId: "958587822012",
            appId: "1:958587822012:web:312cf3d9e7c87e1c6415b9",
            measurementId: "G-N34T3VRGX0"
        };
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUserEmail = null;

        // -------------------------------------------------------------
        //                 Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        // -------------------------------------------------------------
        async function loadUserData(email) {
            currentUserEmail = email;
            document.getElementById('currentEmailDisplay').textContent = email;

            const userDocRef = doc(db, "users", email);
            const userDoc = await getDoc(userDocRef);

            if (userDoc.exists()) {
                const userData = userDoc.data();
                // Ø¹Ø±Ø¶ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙŠ Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
                document.getElementById('usernameInput').value = userData.username || '';
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙˆØ±Ø© (Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ù‡Ø§ ØªØ¸Ù‡Ø±)
                document.getElementById('currentAvatar').src = userData.avatarUrl || "https://via.placeholder.com/100/1e1e1e/ffffff?text=U";
            }
        }
        
        // -------------------------------------------------------------
        //             ğŸ”¥ Ø¯Ø§Ù„Ø© Ø­ÙØ¸ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ ğŸ”¥
        // -------------------------------------------------------------
        async function saveUsername() {
            if (!currentUserEmail) return;

            const newUsername = document.getElementById('usernameInput').value.trim();
            if (newUsername.length < 3 || newUsername.length > 15) {
                alert("ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨ÙŠÙ† 3 Ùˆ 15 Ø­Ø±ÙØ§Ù‹.");
                return;
            }

            try {
                const userDocRef = doc(db, "users", currentUserEmail);
                await updateDoc(userDocRef, {
                    username: newUsername
                });
                alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­!");
            } catch (error) {
                console.error("Error updating username:", error);
                alert("âŒ ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù….");
            }
        }


        // -------------------------------------------------------------
        //                   Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¯Ø®ÙˆÙ„
        // -------------------------------------------------------------
        onAuthStateChanged(auth, (user) => {
            if (user) {
                loadUserData(user.email);
            } else {
                window.location.href = "login.html";
            }
        });

        // Ø±Ø¨Ø· Ø§Ù„Ø²Ø± Ø¨Ø§Ù„Ø¯Ø§Ù„Ø©
        document.getElementById('saveUsernameBtn').addEventListener('click', saveUsername);
        
        // Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        document.getElementById('logoutBtn').addEventListener('click', () => {
            signOut(auth).then(() => {
                window.location.href = "index.html";
            });
        });

        // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù„ØºØ©
        loadLanguage();
    </script>
</body>
</html>
